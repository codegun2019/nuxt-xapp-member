<template>
  <div class="min-h-screen flex flex-col bg-gray-50">
    <!-- Header -->
    <header class="bg-pink-600 text-white p-4 flex justify-between items-center">
      <div class="text-2xl font-bold tracking-wider">XBET</div>
      <button class="ml-2">
        <span class="h-8 w-8">‚ò∞</span>
      </button>
    </header>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col p-4 pb-20">
      <!-- Login Card -->
      <div class="max-w-md w-full mx-auto mt-16 bg-white rounded-2xl shadow-sm p-6 border border-gray-100">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-1">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h1>
        <p class="text-center text-gray-500 mb-6">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
        
        <form @submit.prevent="login" class="space-y-6">
          <div>
            <label for="username" class="block text-gray-700 font-medium mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
            <input 
              type="text" 
              id="username" 
              v-model="username" 
              placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå" 
              class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-pink-500"
            />
          </div>
          
          <div>
            <div class="flex justify-between items-center mb-2">
              <label for="password" class="block text-gray-700 font-medium">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
              <a href="#" class="text-pink-500 text-sm hover:underline">‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô?</a>
            </div>
            <input 
              type="password" 
              id="password" 
              v-model="password" 
              placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" 
              class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-pink-500"
            />
          </div>
          
          <button 
            type="submit" 
            class="rounded-full font-bold flex items-center justify-center gap-2 transition-all duration-200 hover:scale-[1.02] relative overflow-hidden py-4 px-8 text-lg bg-gradient-to-b from-pink-500 to-pink-600 hover:from-pink-600 hover:to-pink-700 text-white shadow-lg shadow-pink-500/20 w-full"
            :disabled="isLoading"
          >
            {{ isLoading ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...' : '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö' }}
          </button>
          
          <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö -->
          <div class="mt-4 p-3 bg-blue-50 text-blue-700 rounded-lg text-sm">
            <p class="font-medium mb-1">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö:</p>
            <ul class="list-disc pl-5 space-y-1">
              <li>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: user123, ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô: password123</li>
              <li>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: gamer555, ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô: gamer555pwd</li>
              <li>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: lucky888, ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô: lucky888pwd</li>
            </ul>
          </div>
        </form>
        
        <div class="text-center mt-6">
          <p class="text-gray-600">
            ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? <a href="#" class="text-pink-500 font-medium hover:underline">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</a>
          </p>
        </div>
      </div>
    </main>

    <!-- Bottom Navigation -->
    <nav class="bg-pink-500 text-white fixed bottom-0 left-0 right-0">
      <div class="flex justify-around">
        <a href="#" class="flex flex-col items-center py-2 px-4">
          <span class="h-6 w-6">üè†</span>
          <span class="text-xs mt-1">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</span>
        </a>
        <a href="#" class="flex flex-col items-center py-2 px-4">
          <span class="h-6 w-6">üí∞</span>
          <span class="text-xs mt-1">‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</span>
        </a>
        <div class="relative">
          <div class="absolute -top-8 left-1/2 transform -translate-x-1/2">
            <div class="bg-pink-500 rounded-full p-4 shadow-lg">
              <span class="h-8 w-8">üéÆ</span>
            </div>
          </div>
          <div class="flex flex-col items-center pt-10 pb-2 px-4">
            <span class="text-xs">‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°</span>
          </div>
        </div>
        <a href="#" class="flex flex-col items-center py-2 px-4">
          <span class="h-6 w-6">üí≥</span>
          <span class="text-xs mt-1">‡∏ù‡∏≤‡∏Å‡πÄ‡∏á‡∏¥‡∏ô</span>
        </a>
        <a href="#" class="flex flex-col items-center py-2 px-4">
          <span class="h-6 w-6">üí¨</span>
          <span class="text-xs mt-1">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</span>
        </a>
      </div>
    </nav>
    
    <!-- Error Popup 
1. `scale-in` (default): ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏à‡∏≤‡∏Å‡πÄ‡∏•‡πá‡∏Å‡πÑ‡∏õ‡πÉ‡∏´‡∏ç‡πà
2. `slide-down`: ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏•‡∏á‡∏à‡∏≤‡∏Å‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô
3. `slide-up`: ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏à‡∏≤‡∏Å‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á
4. `bounce-in`: ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡πÄ‡∏î‡πâ‡∏á
    -->
    <Popup v-model="showErrorPopup" animation="slide-up">
      <div class="text-center">
        <h2 class="text-2xl font-bold text-pink-500 mb-4">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô!</h2>
        <p class="text-gray-700">{{ errorMessage }}</p>
      </div>
    </Popup>
  </div>
</template>

<script setup>
import { ref } from 'vue'
import { useAuth } from '~/composables/useAuth'
import { useRouter } from 'vue-router'
import Popup from '~/components/ui/Popup.vue'

// Initialize refs outside the login function
const username = ref('')
const password = ref('')
const rememberMe = ref(true)
const isLoading = ref(false)
const showErrorPopup = ref(false)
const errorMessage = ref('')

const auth = useAuth()
const router = useRouter()



const login = async () => {
  if (!username.value || !password.value) {
    errorMessage.value = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô'
    showErrorPopup.value = true
    return
  }
  
  isLoading.value = true
  
  try {
    await auth.login({
      username: username.value,
      password: password.value,
      rememberMe: rememberMe.value
    })
    
    // ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
    router.push('/')
  } catch (err) {
    errorMessage.value = err.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö'
    showErrorPopup.value = true
  } finally {
    isLoading.value = false
  }
}
</script>
